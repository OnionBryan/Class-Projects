<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimating ROI on Leadership Development - Avolio et al. (2010)</title>
    <!-- 
      This HTML file is an adaptation of a template, using its CSS and structure
      to visualize the concepts from:
      Avolio, B. J., Avey, J. B., & Quisenberry, D. (2010). 
      Estimating return on leadership development investment. 
      The Leadership Quarterly, 21(4), 633-644.
      
      VERSION 2: Enhanced fonts (Playfair Display, Lato) and improved
      visual styling for a more professional presentation.
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            /* FONT UPGRADE: Using Lato for all body text */
            font-family: 'Lato', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e8ba3 100%);
            color: #333;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* --- UPGRADED TYPOGRAPHY --- */
        
        /* FONT UPGRADE: Using Playfair Display for all major headings */
        h1, h2, h3, .definition-term, .result-box-label, .card h4, .breakdown-header {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
        }

        /* Page Navigation */
        .page-nav-container {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .page-nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .page-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            font-family: 'Lato', sans-serif; /* Apply body font */
            font-weight: 700;
        }

        .page-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .page-btn.active {
            background: white;
            color: #1e3c72;
            border-color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            text-align: center;
            color: white;
            padding: 60px 20px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 40px;
            animation: fadeIn 1s ease;
        }

        .header h1 {
            font-size: 3.2em; /* Slightly larger */
            margin-bottom: 15px;
            /* STYLE UPGRADE: Brighter gradient, softer shadow */
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #ffffff, #d4e9fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.4em;
            opacity: 0.95;
            margin-bottom: 10px;
        }

        .header .stats-preview {
            font-size: 1.1em;
            background: rgba(255,255,255,0.1);
            display: inline-block;
            padding: 10px 25px;
            border-radius: 25px;
            margin-top: 15px;
        }

        /* Section Styles */
        .section {
            /* STYLE UPGRADE: Softer background, shadow, and radius */
            background: #fdfdff;
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.8s ease;
        }

        .section h2 {
            color: #1e3c72;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 4px solid #1e3c72;
            font-size: 2.2em; /* Slightly larger */
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #2a5298;
            margin: 25px 0 15px;
            font-size: 1.6em; /* Slightly larger */
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        /* Card Styles */
        .card {
            /* STYLE UPGRADE: Cleaner white background, top border accent */
            background: #ffffff;
            padding: 25px;
            border-radius: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            border-top: 4px solid #2a5298;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            /* STYLE UPGRADE: Softer hover shadow */
            box-shadow: 0 12px 24px rgba(30,60,114,0.15);
            border-color: #2a5298;
        }

        .card h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.3em; /* Slightly larger */
        }

        /* Stat Box Styles */
        .stat-box {
            /* STYLE UPGRADE: Richer, deeper gradient and softer text */
            background: linear-gradient(135deg, #1d3557 0%, #457b9d 100%);
            color: #f1faee;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-box::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(30,60,114,0.4);
        }

        .stat-value {
            font-size: 2.8em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.95;
        }

        /* Key Finding Box */
        .key-finding {
            /* STYLE UPGRADE: Professional amber/gold gradient */
            background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            font-size: 1.15em;
            box-shadow: 0 8px 20px rgba(230, 126, 34, 0.3);
            border-left: 5px solid #d35400;
        }

        /* Insight Box */
        .insight-box {
            /* STYLE UPGRADE: Professional teal gradient */
            background: linear-gradient(135deg, #005f73 0%, #0a9396 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 20px rgba(0, 95, 115, 0.3);
        }

        /* Tab System */
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #f0f4f8;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            font-family: 'Lato', sans-serif; /* Apply body font */
        }

        .tab:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-color: #1e3c72;
            box-shadow: 0 5px 15px rgba(30,60,114,0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 25px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 700;
            font-size: 1.1em;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e0e6ed;
            background: white;
        }

        tr:hover td {
            background: #f8f9fa;
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Path Model / Process Flow */
        .path-model {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            position: relative;
        }

        .path-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: inline-block;
            margin: 10px;
            transition: all 0.3s ease;
            border: 1px solid #e0e6ed;
        }

        .path-box:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .path-arrow {
            font-size: 2em;
            color: #2a5298;
            margin: 0 10px;
            display: block;
            text-align: center;
        }

        /* --- FEATURE UPGRADE: Interactive Demo --- */
        .interactive-demo {
            /* STYLE UPGRADE: Cleaner, bordered look */
            background: #ffffff;
            border: 1px solid #e0e6ed;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .slider-group {
            margin: 25px 0; /* More spacing */
        }
        
        .slider-label {
            display: block;
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 15px; /* More spacing */
        }
        
        .slider-label span {
            float: right;
            font-weight: bold;
            color: #1e3c72;
            font-size: 1.1em;
        }

        .slider {
            width: 100%;
            height: 10px; /* Thicker track */
            border-radius: 5px;
            background: #d0d9e2; /* Track background */
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 10px;
            cursor: pointer;
            background: #d0d9e2;
            border-radius: 5px;
        }
        
        /* STYLE UPGRADE: New thumb design */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: #ffffff;
            border: 4px solid #1e3c72;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            margin-top: -8px; /* Center thumb */
        }

        .slider::-moz-range-thumb {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: #ffffff;
            border: 4px solid #1e3c72;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border: none;
        }
        
        /* STYLE UPGRADE: Apply custom gradient to slider track */
        /* This is a visual trick, the slider itself is simple, this gradient is in the container */
        .slider-container-visual {
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
            padding: 2px;
            border-radius: 7px;
        }
        /* Re-styling slider to be transparent and sit on top */
        .slider.visual {
            background: transparent;
        }
        .slider.visual::-webkit-slider-runnable-track {
            background: transparent;
        }
        /* --- End of Slider Hack --- */


        .result-display {
            padding: 25px;
            background: white;
            border-radius: 15px;
            margin-top: 30px;
            border: 3px solid #1e3c72;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .result-grid {
             display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-box {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .result-box-label {
            font-size: 1.2em; /* Slightly larger */
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 8px;
        }
        
        .result-box-value {
            font-size: 2.5em; /* Larger font for impact */
            font-weight: 700;
        }
        
        .positive-value {
            color: #4caf50;
        }
        
        .negative-value {
            color: #f44336;
        }

        /* Argument Results (Replaced Hypothesis) */
        .argument-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid;
            background: #e8f5e9;
            border-color: #4caf50;
        }

        /* Attribution */
        .attribution {
            background: #1a237e;
            color: white;
            text-align: center;
            padding: 40px;
            border-radius: 20px;
            margin-top: 40px;
        }

        .attribution a {
            color: #64b5f6;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .attribution a:hover {
            color: #90caf9;
            text-decoration: underline;
        }

        /* Chart Styles */
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 30px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
        }
        
        .chart-axis-y {
            position: absolute;
            left: 20px;
            top: 20px;
            bottom: 40px;
            width: 2px;
            background: #aaa;
        }
        
        .chart-axis-x {
            position: absolute;
            bottom: 40px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: #aaa;
        }

        .bar {
            width: 60px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            text-align: center;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            position: relative;
            /* STYLE UPGRADE: More 3D feel */
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.2);
            border: 1px solid rgba(0,0,0,0.1);
        }

        .bar:hover {
            opacity: 0.9;
            transform: scale(1.05);
            z-index: 10;
        }

        .bar-label {
            padding: 5px;
            font-size: 0.9em;
            font-weight: bold;
            position: absolute;
            bottom: -30px;
            width: 100%;
            text-align: center;
            color: #333;
        }

        .bar-value {
            padding: 10px 5px;
            font-size: 1.1em;
            font-weight: bold;
        }

        /* --- FEATURE UPGRADE: Definition Card --- */
        .definition-card {
            background: #fdfdff; /* Softer white */
            border-left: 5px solid #2a5298;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* Softer shadow */
        }
        
        /* Special definition card inside calculator */
        .result-display .definition-card {
            background: #f8f9fa;
            border: 1px dashed #2a5298;
            border-left: 5px solid #2a5298;
        }

        .definition-term {
            font-size: 1.4em; /* Slightly larger */
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .definition-content {
            line-height: 1.8;
        }
        
        .definition-content code {
            background: #f0f4f8;
            padding: 3px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: #c62828;
            font-size: 1.1em;
        }

        /* Practical Breakdown Styles */
        .breakdown-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .breakdown-header {
            color: #1e3c72;
            font-size: 1.5em; /* Slightly larger */
            margin-bottom: 20px;
            font-weight: bold;
        }

        .breakdown-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #2a5298;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 2.2em; }
            .section h2 { font-size: 1.8em; }
            .grid { grid-template-columns: 1fr; }
            .section { padding: 25px; }
            .tabs { flex-direction: column; }
            .tab { width: 100%; text-align: center; }
            .page-btn { padding: 8px 15px; font-size: 0.9em; }
            .chart-container { 
                height: auto; 
                flex-direction: column; 
                align-items: stretch; 
                justify-content: flex-end; 
                gap: 45px; 
                padding-bottom: 50px; 
                background: #f8f9fa;
            }
            .bar { 
                height: 50px !important; 
                width: 100%; 
                max-width: none; 
                flex-direction: row; 
                align-items: center; 
                justify-content: space-between; 
                border-radius: 5px;
                padding: 0 10px;
            }
            .bar-label { 
                position: static; 
                color: white; 
                width: auto; 
                font-size: 0.8em;
            }
            .bar-value { 
                position: static; 
                font-size: 1em;
            }
            .chart-axis-x, .chart-axis-y { display: none; }
            
            table { font-size: 0.85em; }
            .result-grid { grid-template-columns: 1fr; }
            .path-arrow { transform: rotate(90deg); margin: 15px 0; }
        }

        /* Page visibility */
        #main { display: block; }
        #analysis { display: none; }

        /* --- DARK MODE STYLES --- */
        body.dark-mode {
            background: linear-gradient(135deg, #0a1929 0%, #1a2332 50%, #2d3748 100%);
        }

        body.dark-mode .section {
            background: #1e293b;
            color: #e2e8f0;
        }

        body.dark-mode .header {
            background: rgba(15, 23, 42, 0.8);
        }

        body.dark-mode .card {
            background: #334155;
            color: #e2e8f0;
        }

        body.dark-mode .card h4 {
            color: #93c5fd;
        }

        body.dark-mode .section h2 {
            color: #93c5fd;
            border-bottom-color: #3b82f6;
        }

        body.dark-mode .section h3 {
            color: #93c5fd;
        }

        body.dark-mode table td {
            background: #334155;
            color: #e2e8f0;
        }

        body.dark-mode table tr:hover td {
            background: #475569;
        }

        body.dark-mode .interactive-demo {
            background: #1e293b;
            border-color: #475569;
        }

        body.dark-mode .result-display {
            background: #1e293b;
        }

        body.dark-mode .definition-card {
            background: #1e293b;
            color: #e2e8f0;
        }

        body.dark-mode .tab {
            background: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }

        body.dark-mode .attribution {
            background: #0f172a;
        }

        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Progress Indicators */
        .progress-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            position: relative;
        }

        body.dark-mode .progress-indicator {
            background: #1e293b;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .progress-step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e0e6ed;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .progress-step.completed .progress-step-circle {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
        }

        .progress-step.active .progress-step-circle {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            box-shadow: 0 0 20px rgba(30, 60, 114, 0.5);
            animation: pulse-circle 2s ease-in-out infinite;
        }

        @keyframes pulse-circle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .progress-step-label {
            font-size: 0.9em;
            font-weight: 600;
        }

        .progress-connector {
            position: absolute;
            top: 45px;
            left: 0;
            right: 0;
            height: 3px;
            background: #e0e6ed;
            z-index: 0;
        }

        body.dark-mode .progress-connector {
            background: #475569;
        }

        /* Scenario Comparison */
        .scenario-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .scenario-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .scenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.4);
        }

        .scenario-btn.secondary {
            background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #1e3c72;
            position: relative;
        }

        body.dark-mode .comparison-card {
            background: #1e293b;
            border-color: #3b82f6;
        }

        .comparison-card .card-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 15px;
            font-family: 'Playfair Display', serif;
        }

        body.dark-mode .comparison-card .card-title {
            color: #93c5fd;
        }

        .comparison-card .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Risk Level Indicator */
        .risk-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .risk-excellent {
            background: #4caf50;
            color: white;
        }

        .risk-good {
            background: #8bc34a;
            color: white;
        }

        .risk-moderate {
            background: #ff9800;
            color: white;
        }

        .risk-poor {
            background: #f44336;
            color: white;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
        }

        /* Formula Flow Diagram */
        .formula-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 30px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        body.dark-mode .formula-flow {
            background: #1e293b;
        }

        .formula-node {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-width: 100px;
            text-align: center;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        body.dark-mode .formula-node {
            background: #334155;
            color: #e2e8f0;
        }

        .formula-node:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .formula-node.input {
            border: 3px solid #2196f3;
        }

        .formula-node.operation {
            border: 3px solid #ff9800;
        }

        .formula-node.output {
            border: 3px solid #4caf50;
            font-size: 1.2em;
            font-weight: bold;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .formula-arrow {
            font-size: 2em;
            color: #2a5298;
        }

        body.dark-mode .formula-arrow {
            color: #93c5fd;
        }

        /* Animated number transitions */
        .animated-value {
            transition: all 0.5s ease;
        }

        /* Export button */
        .export-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1em;
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(76, 175, 80, 0.6);
        }

        /* Waterfall Chart */
        .waterfall-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 400px;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            position: relative;
        }

        body.dark-mode .waterfall-container {
            background: #1e293b;
        }

        .waterfall-bar {
            flex: 1;
            margin: 0 10px;
            position: relative;
            transition: all 0.5s ease;
        }

        .waterfall-bar-inner {
            width: 100%;
            border-radius: 5px 5px 0 0;
            position: absolute;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.5s ease;
        }

        .waterfall-label {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            font-size: 0.9em;
        }

        /* Scatter Plot */
        .scatter-plot {
            position: relative;
            width: 100%;
            height: 500px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 40px;
            margin: 30px 0;
        }

        body.dark-mode .scatter-plot {
            background: #1e293b;
        }

        .scatter-point {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scatter-point:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        /* Heatmap */
        .heatmap-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 5px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 30px 0;
        }

        body.dark-mode .heatmap-container {
            background: #1e293b;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        /* Timeline visualization */
        .timeline-viz {
            position: relative;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 30px 0;
        }

        body.dark-mode .timeline-viz {
            background: #1e293b;
        }

        .timeline-line {
            position: relative;
            height: 10px;
            background: linear-gradient(90deg, #1e3c72 0%, #4caf50 100%);
            border-radius: 5px;
            margin: 20px 0;
        }

        .timeline-marker {
            position: absolute;
            top: -15px;
            width: 40px;
            height: 40px;
            background: white;
            border: 4px solid #1e3c72;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeline-marker:hover {
            transform: scale(1.2);
        }

        .timeline-label {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
        }

        /* Confidence Interval */
        .confidence-range {
            position: relative;
            height: 60px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }

        body.dark-mode .confidence-range {
            background: #1e293b;
        }

        .confidence-bar {
            position: relative;
            height: 20px;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 50%, #4caf50 100%);
            border-radius: 10px;
            flex: 1;
        }

        .confidence-marker {
            position: absolute;
            top: -10px;
            width: 4px;
            height: 40px;
            background: #1e3c72;
        }

        .confidence-label {
            position: absolute;
            top: -35px;
            font-size: 0.8em;
            font-weight: bold;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle -->
    <button class="dark-mode-toggle" onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>

    <!-- Export Button -->
    <button class="export-btn" onclick="exportReport()">ðŸ“„ Export Report</button>

    <!-- Page Navigation -->
    <div class="page-nav-container">
        <div class="page-nav">
            <button class="page-btn active" onclick="switchPage('main', this)">Framework Overview</button>
            <button class="page-btn" onclick="switchPage('analysis', this)">ROI Calculator & Models</button>
        </div>
    </div>

    <!-- Main Page -->
    <div id="main">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸ’° Estimating Return on Leadership Development Investment</h1>
            <p class="subtitle">A Utility Analysis Framework for HR & Organizations</p>
            <p class="subtitle">Avolio, Avey & Quisenberry (2010) - Interactive Analysis</p>
            <div class="stats-preview">
                ðŸ“ˆ Methodological Framework | ðŸ“Š Utility Analysis Model | ðŸ’¡ Evidence-Based HR
            </div>
        </div>

        <!-- Executive Summary -->
        <div class="section">
            <h2>ðŸ“ˆ Executive Summary</h2>
            <div class="grid">
                <div class="stat-box">
                    <div class="stat-value">$100B+</div>
                    <div class="stat-label">Est. Annual Global LD Spending</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">d â‰ˆ 0.38</div>
                    <div class="stat-label">Avg. Effect Size of LD (Meta-Analysis)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">40%</div>
                    <div class="stat-label">Rule-of-Thumb for SDy (of Salary)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">Î”U</div>
                    <div class="stat-label">The Core Metric: Net Utility Gain ($)</div>
                </div>
            </div>

            <div class="key-finding">
                ðŸ’¡ <strong>Core Argument:</strong> Stop guessing. This paper provides a scientifically-grounded framework using **Utility Analysis (UA)** to move beyond simple satisfaction surveys ("happy sheets") and estimate the actual financial return (ROI) of leadership development in dollar terms.
            </div>

            <div class="insight-box">
                ðŸŽ“ <strong>Key Insight:</strong> The value of "soft skills" like leadership *can* be quantified. By systematically estimating program costs (C), effect size (d), and the value of performance (SDy), organizations can make strategic, data-driven decisions about where to invest their development dollars.
            </div>
        </div>

        <!-- Key Terminology -->
        <div class="section">
            <h2>ðŸ“š Key Concepts & Definitions</h2>
            <div class="grid">
                <div class="card">
                    <h4>Utility Analysis (UA)</h4>
                    <p><strong>Definition:</strong> A method from industrial-organizational psychology used to estimate the dollar value of organizational programs, such as selection procedures or training interventions. It calculates the net financial gain (Î”U) of a program.</p>
                </div>
                
                <div class="card">
                    <h4>Effect Size (d)</h4>
                    <p><strong>Definition:</strong> A standardized measure of the strength of an intervention. It represents the difference in performance (in standard deviations) between the average trained employee and the average untrained employee.</p>
                    <p style="margin-top: 10px;"><strong>Example:</strong> d = 0.5 means the average trained leader performs half a standard deviation better than an untrained one.</p>
                </div>

                <div class="card">
                    <h4>SDy (Standard Deviation of Performance)</h4>
                    <p><strong>Definition:</strong> The variability of job performance in dollars. A high SDy means that high-performing leaders are *vastly* more valuable to the company than low-performing ones. This is a critical multiplier in the utility formula.</p>
                </div>

                <div class="card">
                    <h4>Kirkpatrick's 4-Level Model</h4>
                    <p><strong>Definition:</strong> The traditional model for evaluating training:</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>Level 1:</strong> Reaction (Did they like it?)</li>
                        <li><strong>Level 2:</strong> Learning (Did they learn it?)</li>
                        <li><strong>Level 3:</strong> Behavior (Do they use it?)</li>
                        <li><strong>Level 4:</strong> Results (Did it impact the business?)</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>Limitation:</strong> Most firms stop at Level 1. UA provides a robust method for assessing Level 4.</p>
                </div>
            </div>
        </div>
        
        <!-- The Utility Framework -->
        <div class="section">
            <h2>ðŸ”¬ The Utility Analysis Framework</h2>

            <div class="tabs">
                <button class="tab active" onclick="showTab('formula', this)">The Core Formula</button>
                <button class="tab" onclick="showTab('params', this)">Estimating the Parameters</button>
                <button class="tab" onclick="showTab('cost', this)">Calculating Total Cost</button>
            </div>

            <div id="formula" class="tab-content active">
                <h3>The Core Utility Formula</h3>
                <p>The paper centers on adapting the classic utility analysis formula to estimate the net financial gain (Î”U) from a leadership development program:</p>

                <div class="definition-card" style="background: #f8f9fa; border-left-color: #1e3c72; text-align: center;">
                    <code class="definition-term" style="font-size: 1.2em;">
                        Î”U = (N * T * d * SDy) - (N * C)
                    </code>
                </div>

                <h3 style="margin-top: 40px;">Visual Formula Flow</h3>
                <p>See how each variable flows into the calculation:</p>

                <div class="formula-flow">
                    <div class="formula-node input">
                        <div style="font-size: 0.8em; color: #666;">Number of</div>
                        <div style="font-size: 1.5em; font-weight: bold;">N</div>
                        <div style="font-size: 0.8em; color: #666;">Trainees</div>
                    </div>
                    <span class="formula-arrow">Ã—</span>
                    <div class="formula-node input">
                        <div style="font-size: 0.8em; color: #666;">Duration</div>
                        <div style="font-size: 1.5em; font-weight: bold;">T</div>
                        <div style="font-size: 0.8em; color: #666;">Years</div>
                    </div>
                    <span class="formula-arrow">Ã—</span>
                    <div class="formula-node input">
                        <div style="font-size: 0.8em; color: #666;">Effect Size</div>
                        <div style="font-size: 1.5em; font-weight: bold;">d</div>
                        <div style="font-size: 0.8em; color: #666;">Impact</div>
                    </div>
                    <span class="formula-arrow">Ã—</span>
                    <div class="formula-node input">
                        <div style="font-size: 0.8em; color: #666;">Performance $</div>
                        <div style="font-size: 1.5em; font-weight: bold;">SDy</div>
                        <div style="font-size: 0.8em; color: #666;">Value</div>
                    </div>
                    <span class="formula-arrow">=</span>
                    <div class="formula-node operation">
                        <div style="font-size: 0.8em; color: #666;">Gross Gain</div>
                        <div style="font-size: 1.3em; font-weight: bold;">Total Benefit</div>
                    </div>
                    <span class="formula-arrow">âˆ’</span>
                    <div class="formula-node input">
                        <div style="font-size: 0.8em; color: #666;">Total Cost</div>
                        <div style="font-size: 1.5em; font-weight: bold;">N Ã— C</div>
                        <div style="font-size: 0.8em; color: #666;">Investment</div>
                    </div>
                    <span class="formula-arrow">=</span>
                    <div class="formula-node output">
                        <div style="font-size: 0.8em; color: #666;">Net Utility</div>
                        <div style="font-size: 1.8em; font-weight: bold;">Î”U</div>
                        <div style="font-size: 0.8em; color: #666;">ROI in $</div>
                    </div>
                </div>
                
                <table>
                    <tr>
                        <th>Variable</th>
                        <th>Definition</th>
                        <th>Example</th>
                    </tr>
                    <tr>
                        <td><strong>Î”U</strong></td>
                        <td><strong>Net Utility Gain</strong> (The final ROI in dollars)</td>
                        <td>$500,000</td>
                    </tr>
                    <tr>
                        <td><strong>N</strong></td>
                        <td>Number of leaders trained</td>
                        <td>100 leaders</td>
                    </tr>
                    <tr>
                        <td><strong>T</strong></td>
                        <td>Average tenure of trainees (duration of the effect)</td>
                        <td>3 years</td>
                    </tr>
                    <tr>
                        <td><strong>d</strong></td>
                        <td>Effect size of the training program</td>
                        <td>0.38 (from meta-analysis)</td>
                    </tr>
                    <tr>
                        <td><strong>SDy</strong></td>
                        <td>Standard deviation of performance in dollars</td>
                        <td>$30,000 (40% of $75k salary)</td>
                    </tr>
                    <tr>
                        <td><strong>C</strong></td>
                        <td>Cost of the training per trainee</td>
                        <td>$2,500</td>
                    </tr>
                </table>
            </div>

            <div id="params" class="tab-content">
                <h3>Estimating the Parameters (The "Hard Part")</h3>
                <p>The challenge of UA is finding good estimates for <code>d</code> and <code>SDy</code>.</p>
                
                <div class="definition-card">
                    <div class="definition-term">Estimating SDy (Value of Performance)</div>
                    <div class="definition-content">
                        <p>This is the most controversial parameter. Avolio et al. (2010) suggest several methods:</p>
                        <ul style="margin-left: 20px; line-height: 1.8;">
                            <li><strong>The 40% Rule:</strong> A conservative rule-of-thumb from Hunter & Schmidt (1982) stating that <code>SDy</code> is roughly <strong>40% of the mean salary</strong> for the job. (e.g., for a $100,000/year manager, SDy = $40,000).</li>
                            <li><strong>Global Expert Estimation:</strong> Having senior executives estimate the dollar value of an average vs. a high-performing (85th percentile) leader.</li>
                            <li><strong>CREPID:</strong> A complex method involving breaking down job duties and assigning proportional value.</li>
                        </ul>
                    </div>
                </div>
                
                <div class="definition-card">
                    <div class="definition-term">Finding 'd' (Effect Size)</div>
                    <div class="definition-content">
                        <p>How much better do trained leaders actually perform? The paper suggests:</p>
                         <ul style="margin-left: 20px; line-height: 1.8;">
                            <li><strong>Use Meta-Analyses (Easiest):</strong> Rely on existing scientific literature. The paper cites meta-analyses showing <code>d</code> values for management training are often between <strong>0.30 and 0.70</strong>.</li>
                            <li><strong>Run a Control Group Study (Best):</strong> Measure the performance of a trained group vs. an equivalent untrained group. This is the most accurate but most difficult method.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="cost" class="tab-content">
                <h3>Calculating Total Cost (C)</h3>
                <p>This is more than just the price of the workshop. A full accounting of costs is critical for a true ROI calculation.</p>
                
                <div class="grid">
                    <div class="card">
                        <h4>Direct Costs</h4>
                         <ul style="margin-left: 20px;">
                            <li>Trainer/Vendor fees</li>
                            <li>Training materials & licenses</li>
                            <li>Facility rentals</li>
                            <li>Travel and lodging</li>
                            <li>Food and beverages</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Indirect Costs</h4>
                        <ul style="margin-left: 20px;">
                            <li>Trainees' salary/wages for time spent in training (i.e., time away from their job)</li>
                            <li>Salary of internal staff who help organize</li>
                            <li>Lost productivity during the training period</li>
                        </ul>
                    </div>
                </div>
                <div class="insight-box">
                    <strong>Key Insight:</strong> Indirect costs, especially the cost of trainee time, are often the largest single expense in leadership development and must be included.
                </div>
            </div>
        </div>

        <!-- Path Model Visualization -> Replaced with Process Flow -->
        <div class="section">
            <h2>ðŸ”„ The 5-Step ROI Estimation Process</h2>

            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-connector"></div>
                <div class="progress-step completed">
                    <div class="progress-step-circle">1</div>
                    <div class="progress-step-label">Calculate Cost</div>
                </div>
                <div class="progress-step completed">
                    <div class="progress-step-circle">2</div>
                    <div class="progress-step-label">Estimate SDy</div>
                </div>
                <div class="progress-step active">
                    <div class="progress-step-circle">3</div>
                    <div class="progress-step-label">Determine d</div>
                </div>
                <div class="progress-step">
                    <div class="progress-step-circle">4</div>
                    <div class="progress-step-label">Calculate Î”U</div>
                </div>
                <div class="progress-step">
                    <div class="progress-step-circle">5</div>
                    <div class="progress-step-label">Calculate ROI</div>
                </div>
            </div>

            <div class="path-model" style="text-align: center;">
                <div class="path-box">
                    <strong>Step 1: Calculate Total Cost</strong><br>
                    (Sum all direct & indirect costs per trainee, 'C')
                </div>
                <span class="path-arrow">â†“</span>
                <div class="path-box">
                    <strong>Step 2: Estimate SDy</strong><br>
                    (e.g., Use 40% of mean leader salary)
                </div>
                <span class="path-arrow">â†“</span>
                <div class="path-box">
                    <strong>Step 3: Determine Effect Size (d)</strong><br>
                    (Find from meta-analysis or internal study)
                </div>
                <span class="path-arrow">â†“</span>
                <div class="path-box">
                    <strong>Step 4: Calculate Net Utility (Î”U)</strong><br>
                    (Run the formula: Î”U = (N*T*d*SDy) - (N*C))
                </div>
                <span class="path-arrow">â†“</span>
                <div class="path-box" style="background: #e8f5e9;">
                    <strong>Step 5: Calculate Final ROI</strong><br>
                    (ROI % = Net Utility / Total Cost)
                </div>
            </div>
        </div>
        
        <!-- Attribution -->
        <div class="attribution">
            <h3>ðŸ“š About This Presentation</h3>
            <p style="margin-top: 20px;">Interactive visualization of the framework proposed in:</p>
            <p>Avolio, B. J., Avey, J. B., & Quisenberry, D. (2010).</p>
            <p>Estimating return on leadership development investment.</p>
            <p><em>The Leadership Quarterly, 21</em>(4), 633-644.</p>
            <p style="margin-top: 15px;">DOI: <a href="https://doi.org/10.1016/j.leaqua.2010.06.007" target="_blank">10.1016/j.leaqua.2010.06.007</a></p>

            <p style="margin-top: 30px; font-size: 0.9em; opacity: 0.9;">
                This presentation synthesizes the core arguments for using Utility Analysis to<br>
                scientifically estimate the financial returns of leadership development programs.
            </p>

            <p style="margin-top: 20px;">
                <a href="httpsjs://doi.org/10.1016/j.leaqua.2010.06.007" target="_blank">Read Full Paper</a>
            </p>
        </div>
    </div>
    </div>

    <!-- Analysis Page -->
    <div id="analysis">
    <div class="container">
        <!-- Header for Analysis Page -->
        <div class="header">
            <h1>ðŸ§® ROI Calculator & Scenario Analysis</h1>
            <p class="subtitle">Interactively Estimate the Value of Your Leadership Program</p>
        </div>

        <!-- REVISED CALCULATOR -->
        <div class="section">
            <h2>ðŸ§® Interactive ROI Scenario Calculator</h2>

            <!-- Preset Scenarios -->
            <div class="scenario-controls">
                <h3 style="width: 100%; margin: 0 0 15px 0;">Quick Load Preset Scenarios:</h3>
                <button class="scenario-btn" onclick="loadPreset('small-team')">ðŸ‘¥ Small Team Training</button>
                <button class="scenario-btn" onclick="loadPreset('executive')">ðŸ‘” Executive Development</button>
                <button class="scenario-btn" onclick="loadPreset('org-wide')">ðŸ¢ Organization-Wide</button>
                <button class="scenario-btn secondary" onclick="saveCurrentScenario()">ðŸ’¾ Save Current</button>
                <button class="scenario-btn secondary" onclick="toggleComparison()">âš–ï¸ Compare Scenarios</button>
            </div>

            <!-- Comparison Grid (initially hidden) -->
            <div id="comparisonGrid" class="comparison-grid" style="display: none;"></div>

            <div class="interactive-demo">
                <h3>Estimate Your Program's Net Utility (Î”U) and ROI</h3>
                <p style="margin-bottom: 20px;">Adjust the sliders based on your program's parameters and the estimation rules from Avolio et al. (2010). The <strong>40% rule</strong> (SDy = 40% of salary) is used for this calculation.</p>

                <div class="slider-group">
                    <label class="slider-label">Number of Trainees (N): <span id="N_Value">100</span></label>
                    <div class="slider-container-visual">
                        <input type="range" class="slider visual" id="N_Slider" min="10" max="500" value="100" step="10" oninput="calculateROI()">
                    </div>
                </div>
                
                <div class="slider-group">
                    <label class="slider-label">Avg. Trainee Salary: <span id="Salary_Value">$80,000</span></label>
                    <div class="slider-container-visual">
                        <input type="range" class="slider visual" id="Salary_Slider" min="40000" max="250000" value="80000" step="5000" oninput="calculateROI()">
                    </div>
                </div>
                
                <div class="slider-group">
                    <label class="slider-label">Program Cost per Trainee (C): <span id="Cost_Value">$5,000</span></label>
                    <div class="slider-container-visual">
                        <input type="range" class="slider visual" id="Cost_Slider" min="500" max="20000" value="5000" step="500" oninput="calculateROI()">
                    </div>
                </div>
                
                <div class="slider-group">
                    <label class="slider-label">Program Effect Size (d): <span id="d_Value">0.38</span></label>
                    <p style="font-size: 0.9em; font-style: italic; margin-top: -12px; margin-bottom: 10px; color: #666;">
                        (e.g., 0.2 = Small, 0.38 = Avg. LD Program, 0.6 = High-Impact)
                    </p>
                    <div class="slider-container-visual">
                        <input type="range" class="slider visual" id="d_Slider" min="0.1" max="1.0" value="0.38" step="0.01" oninput="calculateROI()">
                    </div>
                </div>

                <div class="slider-group">
                    <label class="slider-label">Effect Duration in Years (T): <span id="T_Value">3</span></label>
                    <div class="slider-container-visual">
                        <input type="range" class="slider visual" id="T_Slider" min="1" max="10" value="3" step="1" oninput="calculateROI()">
                    </div>
                </div>

                <div id="calculatorResult" class="result-display">
                    <h3 style="color: #1e3c72; margin-bottom: 20px; text-align: center;">
                        ðŸ“Š Projected Financial Impact
                        <span id="riskIndicator" class="risk-indicator risk-excellent">Excellent ROI</span>
                    </h3>
                    
                    <div class="definition-card">
                        <div class="definition-term">Key Calculation (SDy)</div>
                        <div class="definition-content" id="calc_SDy_Display">
                            <code><strong>SDy (Value of Performance)</strong> = 40% of $80,000 = <strong>$32,000</strong></code>
                        </div>
                    </div>
                    
                    <div class="result-grid">
                        <div class="result-box" style="background: #fdebee;">
                            <div class="result-box-label">Total Program Cost</div>
                            <div class="result-box-value negative-value" id="res_TotalCost">$500,000</div>
                        </div>
                        <div class="result-box" style="background: #e8f5e9;">
                            <div class="result-box-label">Total Program Gain (Gross)</div>
                            <div class="result-box-value positive-value" id="res_TotalGain">$3,648,000</div>
                        </div>
                    </div>
                    
                    <div class="result-grid" style="margin-top: 10px; grid-template-columns: 1fr;">
                         <div class="result-box" style="background: #fff3e0; border: 2px solid #ff9800;">
                            <div class="result-box-label">Net Utility (Î”U)</div>
                            <div class="result-box-value positive-value" id="res_NetUtility">$3,148,000</div>
                        </div>
                        <div class="result-box" style="background: #fff3e0; border: 2px solid #ff9800;">
                            <div class="result-box-label">Return on Investment (ROI)</div>
                            <div class="result-box-value positive-value" id="res_ROI">629.6%</div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <!-- Chart 1: Sensitivity Analysis -->
        <div class="section">
            <h2>ðŸ“ˆ Sensitivity Analysis: Impact of Effect Size (d)</h2>
            <p>This chart shows how the Net Utility (financial gain) changes based on the program's quality (effect size 'd'), holding other calculator values constant.</p>
            <div class="chart-container" id="effectSizeChart">
                <div class="chart-axis-x"></div><div class="chart-axis-y"></div>
                <!-- Chart will be populated by JavaScript -->
            </div>
            <div class="insight-box">
                <strong>Key Pattern:</strong> The relationship is linear. Doubling your program's effectiveness (e.g., from d=0.2 to d=0.4) will double its gross financial return. This highlights the value of using high-quality, evidence-based program designs.
            </div>
        </div>

        <!-- Chart 2: Cost vs. Utility -->
        <div class="section">
            <h2>ðŸŽ¯ Sensitivity Analysis: Impact of Program Cost (C)</h2>
            <p>This chart shows how Net Utility changes based on program cost, holding other calculator values constant. Even an expensive program can have a massive payoff if its effect size ('d') is strong.</p>
            <div class="chart-container" id="costChart">
                <div class="chart-axis-x"></div><div class="chart-axis-y"></div>
                <!-- Chart will be populated by JavaScript -->
            </div>
        </div>

        <!-- NEW: Waterfall Chart -->
        <div class="section">
            <h2>ðŸ’§ Waterfall Analysis: Components of Net Utility</h2>
            <p>This waterfall chart breaks down how each component contributes to your final Net Utility (Î”U):</p>
            <div class="waterfall-container" id="waterfallChart">
                <!-- Chart will be populated by JavaScript -->
            </div>
        </div>

        <!-- NEW: ROI Heatmap -->
        <div class="section">
            <h2>ðŸ”¥ ROI Heatmap: Effect Size vs. Cost</h2>
            <p>Explore different combinations of program quality (d) and cost (C) to see their impact on ROI percentage:</p>
            <div class="heatmap-container" id="roiHeatmap">
                <!-- Heatmap will be populated by JavaScript -->
            </div>
        </div>

        <!-- NEW: Scatter Plot -->
        <div class="section">
            <h2>ðŸ“ Interactive Scenario Explorer</h2>
            <p>Each bubble represents a different scenario. X-axis: Effect Size (d), Y-axis: Program Cost (C), Bubble Size: Net Utility (Î”U)</p>
            <div class="scatter-plot" id="scatterPlot">
                <!-- Scatter plot will be populated by JavaScript -->
            </div>
        </div>

        <!-- NEW: Timeline Visualization -->
        <div class="section">
            <h2>â³ Value Accumulation Over Time</h2>
            <p>See how the program's value accumulates year-by-year based on your current parameters:</p>
            <div class="timeline-viz" id="timelineViz">
                <h4 style="text-align: center; margin-bottom: 20px;">Cumulative Utility Over <span id="timeline_years">3</span> Years</h4>
                <div class="timeline-line" id="timelineLine">
                    <!-- Timeline markers will be populated by JavaScript -->
                </div>
                <div style="margin-top: 60px; text-align: center; font-size: 1.1em;">
                    <strong>Year-by-Year Breakdown:</strong>
                    <div id="timelineBreakdown" style="margin-top: 15px;"></div>
                </div>
            </div>
        </div>

        <!-- NEW: Break-Even Calculator -->
        <div class="section">
            <h2>âš–ï¸ Break-Even Analysis</h2>
            <p>At what program cost does ROI reach 0%? This shows your maximum viable cost per trainee:</p>
            <div class="interactive-demo">
                <div id="breakEvenDisplay" style="text-align: center; padding: 30px; background: #f8f9fa; border-radius: 15px;">
                    <div style="font-size: 1.2em; margin-bottom: 15px;">Break-Even Cost Per Trainee:</div>
                    <div style="font-size: 3em; font-weight: bold; color: #ff9800;" id="breakEvenValue">$10,000</div>
                    <div style="margin-top: 20px; font-size: 1.1em; color: #666;">
                        Your current cost: <strong id="currentCostDisplay">$5,000</strong><br>
                        Safety margin: <strong id="safetyMargin" style="color: #4caf50;">$5,000 (50%)</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Confidence Intervals -->
        <div class="section">
            <h2>ðŸ“Š Confidence Range: Best, Likely, Worst Scenarios</h2>
            <p>See the range of possible outcomes based on conservative, most-likely, and optimistic estimates for effect size:</p>
            <div class="interactive-demo">
                <div style="margin-bottom: 30px;">
                    <h4>Scenario Assumptions:</h4>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li><strong>Worst Case:</strong> Effect size (d) = 0.2 (conservative estimate)</li>
                        <li><strong>Most Likely:</strong> Effect size (d) = <span id="conf_likely_d">0.38</span> (your current estimate)</li>
                        <li><strong>Best Case:</strong> Effect size (d) = 0.7 (optimistic estimate)</li>
                    </ul>
                </div>
                <div class="confidence-range">
                    <div class="confidence-bar">
                        <div class="confidence-marker" style="left: 10%;">
                            <div class="confidence-label" id="worstCaseLabel">Worst: $500K</div>
                        </div>
                        <div class="confidence-marker" style="left: 50%; background: #ff9800;">
                            <div class="confidence-label" style="color: #ff9800;" id="likelyCaseLabel">Likely: $3.1M</div>
                        </div>
                        <div class="confidence-marker" style="left: 90%;">
                            <div class="confidence-label" id="bestCaseLabel">Best: $6M</div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 40px; text-align: center;">
                    <div style="display: inline-block; text-align: left; background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 10px;">Expected Range:</div>
                        <div id="confidenceRangeSummary">
                            Net Utility will likely fall between <strong>$500K - $6M</strong>, with most likely outcome around <strong>$3.1M</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: What-If Comparison Table -->
        <div class="section">
            <h2>ðŸ¤” What-If Analysis Table</h2>
            <p>Compare how small changes to key variables affect your ROI:</p>
            <div style="overflow-x: auto;">
                <table id="whatIfTable">
                    <thead>
                        <tr>
                            <th>Scenario</th>
                            <th>Change</th>
                            <th>Net Utility (Î”U)</th>
                            <th>ROI %</th>
                            <th>Impact vs. Baseline</th>
                        </tr>
                    </thead>
                    <tbody id="whatIfTableBody">
                        <!-- Table will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Comprehensive Definitions -->
        <div class="section">
            <h2>ðŸ“– Comprehensive Glossary of UA Terms</h2>

            <div class="definition-card">
                <div class="definition-term">Utility Analysis (UA)</div>
                <div class="definition-content">
                    <p><strong>Core Concept:</strong> A set of models and methods used to describe, predict, and explain the usefulness or value of organizational interventions (like training) in financial terms.</p>
                    <p style="margin-top: 10px;"><strong>Purpose:</strong> To move beyond "Did they like it?" (Kirkpatrick Level 1) and "Did they learn it?" (Level 2) to "What financial impact did this program have on the business?" (Level 4).</p>
                </div>
            </div>
            
            <div class="definition-card">
                <div class="definition-term">SDy (Standard Deviation of Job Performance in Dollars)</div>
                <div class="definition-content">
                    <p><strong>Core Concept:</strong> The monetary value of performance variability. It answers: "How much more valuable (in dollars) is a high-performing leader (e.g., 85th percentile) than an average-performing leader (50th percentile)?"</p>
                    <p style="margin-top: 10px;"><strong>The 40% Rule:</strong> The most common estimation, based on meta-analyses by Hunter & Schmidt, is that <code>SDy</code> is approximately <strong>40% of the job's mean salary</strong>. Avolio et al. (2010) support this as a "conservative" and reasonable starting point.</p>
                    <p style="margin-top: 10px;">Example: If a manager's average salary is $100,000, the <code>SDy</code> is estimated at $40,000.</p>
                </div>
            </div>

            <div class="definition-card">
                <div class="definition-term">d (Effect Size)</div>
                <div class="definition-content">
                    <p><strong>Core Concept:</strong> The magnitude of the program's impact, expressed in standard deviations. It is the standardized mean difference in performance between the trained and untrained groups.</p>
                    <p style="margin-top: 10px;"><strong>How to Find 'd':</strong></p>
                    <ul style="margin-left: 20px;">
                        <li><strong>From Meta-Analysis:</strong> Avolio et al. (2010) cite studies showing average <code>d</code> for managerial training is around <strong>0.38</strong>, while some interventions (like Pygmalion-effect training) can be <strong>0.70</strong> or higher.</li>
                        <li><strong>From Internal Study:</strong> <code>d = (Performance_Trained_Group - Performance_Control_Group) / Pooled_Standard_Deviation</code>.</li>
                    </ul>
                </div>
            </div>

            <div class="definition-card">
                <div class="definition-term">C (Program Cost)</div>
                <div class="definition-content">
                    <p><strong>Core Concept:</strong> The *total* cost per trainee. The paper emphasizes the need to be thorough.</p>
                    <p style="margin-top: 10px;"><strong>Formula:</strong> <code>C = (Direct Costs + Indirect Costs) / N</code></p>
                    <ul style="margin-left: 20px;">
                        <li><strong>Direct Costs:</strong> Materials, vendor fees, travel, facility rental.</li>
                        <li><strong>Indirect Costs:</strong> Trainees' salary and benefits for time spent in training (often the largest cost), administrative support time.</li>
                    </ul>
                </div>
            </div>
            
            <div class="definition-card">
                <div class="definition-term">Î”U (Net Utility) vs. ROI (Return on Investment)</div>
                <div class="definition-content">
                    <p>These are two different, but related, final metrics.</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>Net Utility (Î”U):</strong> The total *dollar value* gained by the organization, after subtracting costs.
                        <br><code>Î”U = Total Gain - Total Cost</code></li>
                        <li><strong>Return on Investment (ROI):</strong> The *percentage return* relative to the cost.
                        <br><code>ROI = (Net Utility / Total Cost) * 100</code></li>
                    </ul>
                     <p style="margin-top: 10px;">Both should be presented. A $10M program that returns $11M has a low ROI (10%) but a high Net Utility (+$1M). A $10k program that returns $50k has a high ROI (400%) but a lower Net Utility (+$40k).</p>
                </div>
            </div>
        </div>

        <!-- Practical Breakdown -->
        <div class="section">
            <h2>ðŸ› ï¸ Practical Implementation Guide</h2>

            <div class="breakdown-section">
                <div class="breakdown-header">Phase 1: Planning & Data Gathering</div>
                <div class="breakdown-item">
                    <h4>Step 1: Identify All Program Costs (C)</h4>
                    <p>Sum all direct costs (vendor, travel, materials) and indirect costs (trainee salary for time in training) and divide by N to get 'C'.</p>
                </div>
                <div class="breakdown-item">
                    <h4>Step 2: Gather Program Data (N, T, Salary)</h4>
                    <p>Determine the number of trainees (N), their average tenure (T), and their mean salary.</p>
                </div>
                 <div class="breakdown-item">
                    <h4>Step 3: Estimate SDy</h4>
                    <p>Apply the 40% rule as a conservative, defensible estimate: <code>SDy = Mean Salary * 0.40</code>.</p>
                </div>
                 <div class="breakdown-item">
                    <h4>Step 4: Estimate Effect Size (d)</h4>
                    <p>Search for meta-analyses on your specific type of training (e.g., "effect size of transformational leadership training") or use a conservative default like d=0.30.</p>
                </div>
            </div>
            
            <div class="breakdown-section">
                <div class="breakdown-header">Phase 2: Calculation & Sensitivity Analysis</div>
                <div class="breakdown-item">
                    <h4>Step 5: Run the Utility Formula</h4>
                    <p>Plug all variables into the formula to find the Net Utility (Î”U):<br>
                    <code>Î”U = (N * T * d * SDy) - (N * C)</code></p>
                </div>
                <div class="breakdown-item">
                    <h4>Step 6: Calculate Final ROI</h4>
                    <p>Convert the Net Utility into a percentage: <br>
                    <code>ROI = (Î”U / (N * C)) * 100</code></p>
                </div>
                 <div class="breakdown-item">
                    <h4>Step 7: Run Sensitivity Analysis (Crucial)</h4>
                    <p>The paper stresses this. Re-run the calculation with "best-case" and "worst-case" estimates for 'd' and 'SDy' to create a credible range of expected returns.</p>
                    <p>Example: "We project a return between $1.2M (worst-case, d=0.2) and $4.5M (best-case, d=0.6), with the most likely estimate being $2.8M."</p>
                </div>
            </div>
        </div>

        <!-- Final Thoughts -->
        <div class="section" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white;">
            <h2 style="color: white; border-bottom-color: white;">ðŸŽ¯ The Bottom Line for Practitioners</h2>

            <div style="font-size: 1.2em; line-height: 2;">
                <p>âœ… <strong>DO:</strong> Use an evidence-based model like Utility Analysis to justify LD investments.</p>
                <p>âœ… <strong>DO:</strong> Be thorough in calculating *all* costs, especially indirect salary costs.</p>
                <p>âœ… <strong>DO:</strong> Use conservative, defensible estimates for <code>SDy</code> (like the 40% rule) and <code>d</code> (from meta-analyses).</p>
                <p>âœ… <strong>DO:</strong> Present a "sensitivity analysis" with a best-case, worst-case, and most-likely scenario to build credibility.</p>

                <p style="margin-top: 20px;">âŒ <strong>DON'T:</strong> Rely only on Level 1 "happy sheets" to prove value.</p>
                <p>âŒ <strong>DON'T:</strong> Be afraid to quantify "soft skills." This framework provides a path.</p>
                <p>âŒ <strong>DON'T:</strong> Present a single, magic ROI number. A calculated *range* is more believable and professional.</p>
            </div>
        </div>
    </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let savedScenarios = [];
        let comparisonMode = false;

        // --- DARK MODE ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.dark-mode-toggle');
            if (document.body.classList.contains('dark-mode')) {
                btn.textContent = 'â˜€ï¸ Light Mode';
            } else {
                btn.textContent = 'ðŸŒ™ Dark Mode';
            }
        }

        // --- PAGE/TAB NAVIGATION ---
        function switchPage(pageId, btn) {
            document.getElementById('main').style.display = 'none';
            document.getElementById('analysis').style.display = 'none';
            document.getElementById(pageId).style.display = 'block';

            document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (pageId === 'analysis') {
                calculateROI(); // Run calculator on page load
                loadAllVisualizations(); // Load all charts and visualizations
            }
        }

        function showTab(tabName, btn) {
            const tabContainer = btn.closest('.section');
            tabContainer.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            tabContainer.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            btn.classList.add('active');
            tabContainer.querySelector('#' + tabName).classList.add('active');
        }

        // --- PRESET SCENARIOS ---
        function loadPreset(presetName) {
            const presets = {
                'small-team': { N: 20, Salary: 60000, Cost: 2000, d: 0.35, T: 2 },
                'executive': { N: 15, Salary: 200000, Cost: 15000, d: 0.50, T: 5 },
                'org-wide': { N: 300, Salary: 75000, Cost: 3000, d: 0.38, T: 3 }
            };

            const preset = presets[presetName];
            if (preset) {
                document.getElementById('N_Slider').value = preset.N;
                document.getElementById('Salary_Slider').value = preset.Salary;
                document.getElementById('Cost_Slider').value = preset.Cost;
                document.getElementById('d_Slider').value = preset.d;
                document.getElementById('T_Slider').value = preset.T;
                calculateROI();
            }
        }

        // --- SCENARIO COMPARISON ---
        function saveCurrentScenario() {
            const scenario = {
                name: `Scenario ${savedScenarios.length + 1}`,
                N: parseFloat(document.getElementById('N_Slider').value),
                Salary: parseFloat(document.getElementById('Salary_Slider').value),
                Cost: parseFloat(document.getElementById('Cost_Slider').value),
                d: parseFloat(document.getElementById('d_Slider').value),
                T: parseFloat(document.getElementById('T_Slider').value)
            };

            savedScenarios.push(scenario);
            alert(`Scenario saved! You now have ${savedScenarios.length} saved scenario(s).`);

            if (comparisonMode) {
                renderComparisonGrid();
            }
        }

        function toggleComparison() {
            comparisonMode = !comparisonMode;
            const grid = document.getElementById('comparisonGrid');

            if (comparisonMode && savedScenarios.length > 0) {
                grid.style.display = 'grid';
                renderComparisonGrid();
            } else if (comparisonMode && savedScenarios.length === 0) {
                alert('Please save at least one scenario first!');
                comparisonMode = false;
            } else {
                grid.style.display = 'none';
            }
        }

        function renderComparisonGrid() {
            const grid = document.getElementById('comparisonGrid');
            grid.innerHTML = '';

            savedScenarios.forEach((scenario, index) => {
                const SDy = scenario.Salary * 0.40;
                const TotalCost = scenario.N * scenario.Cost;
                const TotalGain = scenario.N * scenario.T * scenario.d * SDy;
                const NetUtility = TotalGain - TotalCost;
                const ROI = (TotalCost > 0) ? (NetUtility / TotalCost) * 100 : 0;

                const card = document.createElement('div');
                card.className = 'comparison-card';
                card.innerHTML = `
                    <button class="close-btn" onclick="removeScenario(${index})">Ã—</button>
                    <div class="card-title">${scenario.name}</div>
                    <div style="line-height: 1.8;">
                        <strong>Trainees:</strong> ${scenario.N}<br>
                        <strong>Salary:</strong> ${formatter.format(scenario.Salary)}<br>
                        <strong>Cost:</strong> ${formatter.format(scenario.Cost)}<br>
                        <strong>Effect Size:</strong> ${scenario.d.toFixed(2)}<br>
                        <strong>Duration:</strong> ${scenario.T} years<br>
                        <hr style="margin: 10px 0;">
                        <strong>Net Utility:</strong> <span style="color: #4caf50; font-size: 1.3em;">${formatter.format(NetUtility)}</span><br>
                        <strong>ROI:</strong> <span style="color: #1e3c72; font-size: 1.3em;">${numFormatter.format(ROI)}%</span>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function removeScenario(index) {
            savedScenarios.splice(index, 1);
            renderComparisonGrid();
            if (savedScenarios.length === 0) {
                document.getElementById('comparisonGrid').style.display = 'none';
                comparisonMode = false;
            }
        }

        // --- EXPORT FUNCTIONALITY ---
        function exportReport() {
            const reportContent = generateReportHTML();
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ROI_Analysis_Report.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        function generateReportHTML() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const Cost = parseFloat(document.getElementById('Cost_Slider').value);
            const d = parseFloat(document.getElementById('d_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;
            const TotalCost = N * Cost;
            const TotalGain = N * T * d * SDy;
            const NetUtility = TotalGain - TotalCost;
            const ROI = (TotalCost > 0) ? (NetUtility / TotalCost) * 100 : 0;

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Leadership Development ROI Analysis Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; }
                        h1 { color: #1e3c72; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background: #1e3c72; color: white; }
                        .highlight { background: #e8f5e9; font-weight: bold; font-size: 1.2em; }
                    </style>
                </head>
                <body>
                    <h1>Leadership Development ROI Analysis Report</h1>
                    <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}</p>

                    <h2>Input Parameters</h2>
                    <table>
                        <tr><th>Parameter</th><th>Value</th></tr>
                        <tr><td>Number of Trainees (N)</td><td>${N}</td></tr>
                        <tr><td>Average Salary</td><td>${formatter.format(Salary)}</td></tr>
                        <tr><td>Cost per Trainee (C)</td><td>${formatter.format(Cost)}</td></tr>
                        <tr><td>Effect Size (d)</td><td>${d.toFixed(2)}</td></tr>
                        <tr><td>Duration (T)</td><td>${T} years</td></tr>
                        <tr><td>SDy (40% Rule)</td><td>${formatter.format(SDy)}</td></tr>
                    </table>

                    <h2>Results</h2>
                    <table>
                        <tr><td>Total Program Cost</td><td>${formatter.format(TotalCost)}</td></tr>
                        <tr><td>Total Program Gain</td><td>${formatter.format(TotalGain)}</td></tr>
                        <tr class="highlight"><td>Net Utility (Î”U)</td><td>${formatter.format(NetUtility)}</td></tr>
                        <tr class="highlight"><td>Return on Investment (ROI)</td><td>${numFormatter.format(ROI)}%</td></tr>
                    </table>

                    <p><em>Report generated using the framework from Avolio, B. J., Avey, J. B., & Quisenberry, D. (2010). Estimating return on leadership development investment. The Leadership Quarterly, 21(4), 633-644.</em></p>
                </body>
                </html>
            `;
        }

        // --- ROI CALCULATOR ---
        
        // Helper to format currency
        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            maximumFractionDigits: 0,
        });
        
        // Helper to format numbers
        const numFormatter = new Intl.NumberFormat('en-US', {
            maximumFractionDigits: 0,
        });
        
        function calculateROI() {
            // Get all elements
            const N_Val = document.getElementById('N_Slider').value;
            const Salary_Val = document.getElementById('Salary_Slider').value;
            const Cost_Val = document.getElementById('Cost_Slider').value;
            const d_Val = document.getElementById('d_Slider').value;
            const T_Val = document.getElementById('T_Slider').value;
            
            // Update labels
            document.getElementById('N_Value').textContent = numFormatter.format(N_Val);
            document.getElementById('Salary_Value').textContent = formatter.format(Salary_Val);
            document.getElementById('Cost_Value').textContent = formatter.format(Cost_Val);
            document.getElementById('d_Value').textContent = parseFloat(d_Val).toFixed(2);
            document.getElementById('T_Value').textContent = T_Val;
            
            // --- The Calculation ---
            const N = parseFloat(N_Val);
            const C = parseFloat(Cost_Val);
            const d = parseFloat(d_Val);
            const T = parseFloat(T_Val);
            const Salary = parseFloat(Salary_Val);
            
            // 1. Estimate SDy using the 40% rule
            const SDy = Salary * 0.40;
            
            // 2. Calculate Total Cost
            const TotalCost = N * C;
            
            // 3. Calculate Total Gain (Gross)
            const TotalGain = N * T * d * SDy;
            
            // 4. Calculate Net Utility (Î”U)
            const NetUtility = TotalGain - TotalCost;
            
            // 5. Calculate ROI
            const ROI = (TotalCost > 0) ? (NetUtility / TotalCost) * 100 : 0;
            
            // Update Results Display
            const resultDiv = document.getElementById('calculatorResult');
            if (!resultDiv) return; // Only run on analysis page
            
            resultDiv.querySelector('#calc_SDy_Display').innerHTML = `
                <code><strong>SDy (Value of Performance)</strong> = 40% of ${formatter.format(Salary)} = <strong>${formatter.format(SDy)}</strong></code>
            `;
            
            document.getElementById('res_TotalCost').textContent = formatter.format(TotalCost);
            document.getElementById('res_TotalGain').textContent = formatter.format(TotalGain);
            document.getElementById('res_NetUtility').textContent = formatter.format(NetUtility);
            document.getElementById('res_ROI').textContent = numFormatter.format(ROI) + '%';
            
            // Update positive/negative colors
            updateResultColor(document.getElementById('res_NetUtility'), NetUtility);
            updateResultColor(document.getElementById('res_ROI'), ROI);

            // Update Risk Indicator
            updateRiskIndicator(ROI);

            // Update slider visual fill
            updateSliderFills();

            // Update all visualizations
            if (document.getElementById('analysis').style.display === 'block') {
                loadAllVisualizations();
            }
        }

        function updateRiskIndicator(ROI) {
            const indicator = document.getElementById('riskIndicator');
            if (!indicator) return;

            indicator.classList.remove('risk-excellent', 'risk-good', 'risk-moderate', 'risk-poor');

            if (ROI >= 200) {
                indicator.classList.add('risk-excellent');
                indicator.textContent = 'Excellent ROI';
            } else if (ROI >= 100) {
                indicator.classList.add('risk-good');
                indicator.textContent = 'Good ROI';
            } else if (ROI >= 50) {
                indicator.classList.add('risk-moderate');
                indicator.textContent = 'Moderate ROI';
            } else {
                indicator.classList.add('risk-poor');
                indicator.textContent = 'Poor ROI';
            }
        }
        
        function updateResultColor(element, value) {
            element.classList.remove('positive-value', 'negative-value');
            if (value >= 0) {
                element.classList.add('positive-value');
            } else {
                element.classList.add('negative-value');
            }
        }
        
        function updateSliderFills() {
            document.querySelectorAll('.slider.visual').forEach(slider => {
                const min = parseFloat(slider.min);
                const max = parseFloat(slider.max);
                const val = parseFloat(slider.value);
                const percent = (val - min) / (max - min) * 100;
                
                // Find the parent container and apply the gradient
                const container = slider.closest('.slider-container-visual');
                if (container) {
                    container.style.background = `linear-gradient(90deg, #1e3c72 ${percent}%, #d0d9e2 ${percent}%)`;
                }
            });
        }
        
        // --- MASTER VISUALIZATION LOADER ---
        function loadAllVisualizations() {
            loadCharts(); // Original bar charts
            loadWaterfallChart();
            loadHeatmap();
            loadScatterPlot();
            loadTimeline();
            loadBreakEven();
            loadConfidenceIntervals();
            loadWhatIfTable();
        }

        // --- ANALYSIS PAGE CHARTS (Original Bar Charts) ---
        function loadCharts() {
            // Get current calculator values as baseline
            const N = parseFloat(document.getElementById('N_Slider').value);
            const C = parseFloat(document.getElementById('Cost_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const SDy = Salary * 0.40;

            // --- Chart 1: Effect Size Sensitivity ---
            const effectSizeData = [
                { name: 'd = 0.2 (Weak)', d: 0.2, color: '#ff9800' },
                { name: 'd = 0.4 (Average)', d: 0.4, color: '#2196f3' },
                { name: 'd = 0.6 (Strong)', d: 0.6, color: '#4caf50' },
                { name: 'd = 0.8 (Excellent)', d: 0.8, color: '#9c27b0' }
            ];
            
            let maxUtility_d = -Infinity;
            let minUtility_d = Infinity;
            
            const d_ChartData = effectSizeData.map(item => {
                const gain = N * T * item.d * SDy;
                const cost = N * C;
                const utility = gain - cost;
                if (utility > maxUtility_d) maxUtility_d = utility;
                if (utility < minUtility_d) minUtility_d = utility;
                return { name: item.name, utility: utility, color: item.color };
            });
            
            // Adjust max for scaling
            maxUtility_d = Math.max(Math.abs(maxUtility_d), Math.abs(minUtility_d));
            if (maxUtility_d === 0) maxUtility_d = 1;

            const d_Chart = document.getElementById('effectSizeChart');
            d_Chart.innerHTML = '<div class="chart-axis-x"></div><div class="chart-axis-y"></div>'; // Clear previous
            
            d_ChartData.forEach(item => {
                const barHeight = (item.utility / maxUtility_d) * 300; // 300px max height
                const bar = createBar(item.name, formatter.format(item.utility), barHeight, item.color);
                d_Chart.appendChild(bar);
            });

            // --- Chart 2: Cost Sensitivity ---
            const costData = [
                { name: 'Cost = $1k', cost: 1000, color: '#4caf50' },
                { name: 'Cost = $5k', cost: 5000, color: '#2196f3' },
                { name: 'Cost = $10k', cost: 10000, color: '#ff9800' },
                { name: 'Cost = $15k', cost: 15000, color: '#f44336' }
            ];
            
            const d_baseline = parseFloat(document.getElementById('d_Slider').value);
            let maxUtility_c = -Infinity;
            let minUtility_c = Infinity;
            
            const c_ChartData = costData.map(item => {
                const gain = N * T * d_baseline * SDy;
                const cost = N * item.cost;
                const utility = gain - cost;
                if (utility > maxUtility_c) maxUtility_c = utility;
                if (utility < minUtility_c) minUtility_c = utility;
                return { name: item.name, utility: utility, color: item.color };
            });
            
            // Adjust max for scaling
            maxUtility_c = Math.max(Math.abs(maxUtility_c), Math.abs(minUtility_c));
             if (maxUtility_c === 0) maxUtility_c = 1;


            const c_Chart = document.getElementById('costChart');
            c_Chart.innerHTML = '<div class="chart-axis-x"></div><div class="chart-axis-y"></div>'; // Clear previous
            
            c_ChartData.forEach(item => {
                const barHeight = (item.utility / maxUtility_c) * 300;
                const bar = createBar(item.name, formatter.format(item.utility), barHeight, item.color);
                c_Chart.appendChild(bar);
            });
        }
        
        function createBar(name, value, height, color) {
            const bar = document.createElement('div');
            bar.className = 'bar';
            let displayHeight = Math.abs(height);
            
            // Handle negative values
            if (height < 0) {
                bar.style.height = displayHeight + 'px';
                bar.style.background = '#aaa';
                bar.style.bottom = '40px'; // On top of axis
            } else {
                 bar.style.height = (displayHeight > 20 ? displayHeight : 20) + 'px'; // Min height
                 bar.style.background = color;
                 bar.style.bottom = '40px';
            }
            
            // For responsive mobile view, height is ignored, but value is still needed
            bar.innerHTML = `
                <div class="bar-value">${value}</div>
                <div class="bar-label" style="color: #333;">${name}</div>
            `;
            
            // Re-apply responsive styles for bar-label
            if (window.innerWidth <= 768) {
                 bar.querySelector('.bar-label').style.color = 'white';
            }
            
            return bar;
        }

        // --- WATERFALL CHART ---
        function loadWaterfallChart() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const C = parseFloat(document.getElementById('Cost_Slider').value);
            const d = parseFloat(document.getElementById('d_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;

            const components = [
                { label: 'N (Trainees)', value: N, color: '#2196f3' },
                { label: 'T (Years)', value: N * T, color: '#4caf50' },
                { label: 'd (Effect)', value: N * T * d, color: '#ff9800' },
                { label: 'SDy (Value)', value: N * T * d * SDy, color: '#9c27b0' },
                { label: '- Cost', value: (N * T * d * SDy) - (N * C), color: '#f44336' },
                { label: 'Net Utility', value: (N * T * d * SDy) - (N * C), color: '#4caf50' }
            ];

            const maxValue = Math.max(...components.map(c => Math.abs(c.value)));
            const container = document.getElementById('waterfallChart');
            container.innerHTML = '';

            components.forEach(comp => {
                const barDiv = document.createElement('div');
                barDiv.className = 'waterfall-bar';
                const height = (Math.abs(comp.value) / maxValue) * 300;

                barDiv.innerHTML = `
                    <div class="waterfall-bar-inner" style="height: ${height}px; background: ${comp.color};">
                        ${formatter.format(comp.value)}
                    </div>
                    <div class="waterfall-label">${comp.label}</div>
                `;
                container.appendChild(barDiv);
            });
        }

        // --- HEATMAP ---
        function loadHeatmap() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;

            const dValues = [0.2, 0.3, 0.4, 0.5, 0.6, 0.7];
            const costValues = [1000, 3000, 5000, 7000, 10000, 15000];

            const container = document.getElementById('roiHeatmap');
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${dValues.length}, 1fr)`;

            costValues.forEach(cost => {
                dValues.forEach(d => {
                    const gain = N * T * d * SDy;
                    const totalCost = N * cost;
                    const netUtility = gain - totalCost;
                    const roi = (totalCost > 0) ? (netUtility / totalCost) * 100 : 0;

                    const cell = document.createElement('div');
                    cell.className = 'heatmap-cell';
                    cell.title = `d=${d}, Cost=$${cost}, ROI=${roi.toFixed(0)}%`;

                    // Color based on ROI
                    let bgColor;
                    if (roi >= 200) bgColor = '#4caf50';
                    else if (roi >= 100) bgColor = '#8bc34a';
                    else if (roi >= 50) bgColor = '#ff9800';
                    else bgColor = '#f44336';

                    cell.style.background = bgColor;
                    cell.textContent = `${roi.toFixed(0)}%`;
                    container.appendChild(cell);
                });
            });
        }

        // --- SCATTER PLOT ---
        function loadScatterPlot() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;

            const scenarios = [
                { d: 0.2, cost: 2000 }, { d: 0.3, cost: 3000 }, { d: 0.4, cost: 5000 },
                { d: 0.5, cost: 7000 }, { d: 0.6, cost: 10000 }, { d: 0.7, cost: 15000 },
                { d: 0.35, cost: 4000 }, { d: 0.45, cost: 6000 }, { d: 0.55, cost: 8000 }
            ];

            const container = document.getElementById('scatterPlot');
            container.innerHTML = '';

            // Add axes labels
            container.innerHTML = `
                <div style="position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); font-weight: bold;">Effect Size (d) â†’</div>
                <div style="position: absolute; left: 5px; top: 50%; transform: rotate(-90deg) translateY(-50%); font-weight: bold; transform-origin: center;">Program Cost (C) â†’</div>
            `;

            scenarios.forEach(scenario => {
                const gain = N * T * scenario.d * SDy;
                const totalCost = N * scenario.cost;
                const netUtility = gain - totalCost;

                const x = ((scenario.d - 0.1) / 0.7) * 80 + 10; // 10-90% range
                const y = ((scenario.cost - 1000) / 14000) * 80 + 10; // 10-90% range
                const size = Math.max(30, Math.min(100, Math.abs(netUtility) / 50000)); // Bubble size

                const point = document.createElement('div');
                point.className = 'scatter-point';
                point.style.left = `${x}%`;
                point.style.bottom = `${y}%`;
                point.style.width = `${size}px`;
                point.style.height = `${size}px`;
                point.style.background = netUtility > 0 ? '#4caf50' : '#f44336';
                point.title = `d=${scenario.d}, Cost=$${scenario.cost}, Î”U=${formatter.format(netUtility)}`;
                point.textContent = scenario.d.toFixed(1);

                container.appendChild(point);
            });
        }

        // --- TIMELINE VISUALIZATION ---
        function loadTimeline() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const C = parseFloat(document.getElementById('Cost_Slider').value);
            const d = parseFloat(document.getElementById('d_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;

            document.getElementById('timeline_years').textContent = T;

            const yearlyGain = N * d * SDy;
            const totalCost = N * C;

            const timelineLine = document.getElementById('timelineLine');
            timelineLine.innerHTML = '';

            let cumulativeUtility = -totalCost; // Start with negative (cost)

            for (let year = 0; year <= T; year++) {
                const marker = document.createElement('div');
                marker.className = 'timeline-marker';
                marker.style.left = `${(year / T) * 100}%`;
                marker.textContent = year;

                const label = document.createElement('div');
                label.className = 'timeline-label';
                label.textContent = formatter.format(cumulativeUtility);

                marker.appendChild(label);
                timelineLine.appendChild(marker);

                if (year < T) {
                    cumulativeUtility += yearlyGain;
                }
            }

            // Year-by-year breakdown
            const breakdown = document.getElementById('timelineBreakdown');
            breakdown.innerHTML = '';
            cumulativeUtility = -totalCost;

            for (let year = 1; year <= T; year++) {
                cumulativeUtility += yearlyGain;
                const yearDiv = document.createElement('div');
                yearDiv.style.display = 'inline-block';
                yearDiv.style.margin = '5px 15px';
                yearDiv.innerHTML = `<strong>Year ${year}:</strong> ${formatter.format(cumulativeUtility)}`;
                breakdown.appendChild(yearDiv);
            }
        }

        // --- BREAK-EVEN CALCULATOR ---
        function loadBreakEven() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const C = parseFloat(document.getElementById('Cost_Slider').value);
            const d = parseFloat(document.getElementById('d_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;

            // Break-even: NetUtility = 0, so (N*T*d*SDy) - (N*C_breakeven) = 0
            // C_breakeven = T * d * SDy
            const breakEvenCost = T * d * SDy;

            document.getElementById('breakEvenValue').textContent = formatter.format(breakEvenCost);
            document.getElementById('currentCostDisplay').textContent = formatter.format(C);

            const margin = breakEvenCost - C;
            const marginPercent = (margin / breakEvenCost) * 100;

            const safetyMarginElem = document.getElementById('safetyMargin');
            safetyMarginElem.textContent = `${formatter.format(margin)} (${marginPercent.toFixed(1)}%)`;
            safetyMarginElem.style.color = margin > 0 ? '#4caf50' : '#f44336';
        }

        // --- CONFIDENCE INTERVALS ---
        function loadConfidenceIntervals() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const C = parseFloat(document.getElementById('Cost_Slider').value);
            const d = parseFloat(document.getElementById('d_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;
            const TotalCost = N * C;

            const worstCase = (N * T * 0.2 * SDy) - TotalCost;
            const likelyCase = (N * T * d * SDy) - TotalCost;
            const bestCase = (N * T * 0.7 * SDy) - TotalCost;

            document.getElementById('conf_likely_d').textContent = d.toFixed(2);
            document.getElementById('worstCaseLabel').textContent = `Worst: ${formatter.format(worstCase)}`;
            document.getElementById('likelyCaseLabel').textContent = `Likely: ${formatter.format(likelyCase)}`;
            document.getElementById('bestCaseLabel').textContent = `Best: ${formatter.format(bestCase)}`;

            document.getElementById('confidenceRangeSummary').innerHTML = `
                Net Utility will likely fall between <strong>${formatter.format(worstCase)} - ${formatter.format(bestCase)}</strong>,
                with most likely outcome around <strong>${formatter.format(likelyCase)}</strong>
            `;
        }

        // --- WHAT-IF TABLE ---
        function loadWhatIfTable() {
            const N = parseFloat(document.getElementById('N_Slider').value);
            const Salary = parseFloat(document.getElementById('Salary_Slider').value);
            const C = parseFloat(document.getElementById('Cost_Slider').value);
            const d = parseFloat(document.getElementById('d_Slider').value);
            const T = parseFloat(document.getElementById('T_Slider').value);
            const SDy = Salary * 0.40;

            // Baseline
            const baselineGain = N * T * d * SDy;
            const baselineCost = N * C;
            const baselineUtility = baselineGain - baselineCost;
            const baselineROI = (baselineCost > 0) ? (baselineUtility / baselineCost) * 100 : 0;

            const whatIfScenarios = [
                { name: 'Baseline', change: 'Current parameters', N, Salary, C, d, T },
                { name: 'Increase d by 0.1', change: 'd +0.1', N, Salary, C, d: d + 0.1, T },
                { name: 'Decrease Cost by 20%', change: 'C -20%', N, Salary, C: C * 0.8, d, T },
                { name: 'Train 50% more', change: 'N +50%', N: N * 1.5, Salary, C, d, T },
                { name: 'Extend to +2 years', change: 'T +2', N, Salary, C, d, T: T + 2 }
            ];

            const tbody = document.getElementById('whatIfTableBody');
            tbody.innerHTML = '';

            whatIfScenarios.forEach(scenario => {
                const scenarioSDy = scenario.Salary * 0.40;
                const scenarioGain = scenario.N * scenario.T * scenario.d * scenarioSDy;
                const scenarioCost = scenario.N * scenario.C;
                const scenarioUtility = scenarioGain - scenarioCost;
                const scenarioROI = (scenarioCost > 0) ? (scenarioUtility / scenarioCost) * 100 : 0;

                const impact = scenarioUtility - baselineUtility;
                const impactPercent = ((impact / Math.abs(baselineUtility)) * 100).toFixed(1);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${scenario.name}</strong></td>
                    <td>${scenario.change}</td>
                    <td>${formatter.format(scenarioUtility)}</td>
                    <td>${scenarioROI.toFixed(1)}%</td>
                    <td style="color: ${impact >= 0 ? '#4caf50' : '#f44336'};">
                        ${formatter.format(impact)} (${impactPercent}%)
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize calculator and charts on first load
        (function() {
            // Check if analysis page is active, if so, init
            if (document.getElementById('analysis').style.display === 'block') {
                calculateROI();
                loadAllVisualizations();
            }

            // Initial call to set slider fills
            updateSliderFills();

            // Add listener to recalculate charts on window resize for mobile
            window.addEventListener('resize', () => {
                 if (document.getElementById('analysis').style.display === 'block') {
                    loadAllVisualizations();
                }
            });
        })();
    </script>
</body>
</html>
